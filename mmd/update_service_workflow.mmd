sequenceDiagram
  User->> CloudFoundry: cf update service
  CloudFoundry->> ODB: provision instance
  ODB->>ServiceAdapter: generate manifest with the old manifest
  ServiceAdapter->>ODB: a updated deployment manifest
  ODB->>BOSH: bosh deploy with manifest
  BOSH->>ODB: deploying
  ODB->>CloudFoundry: accepted
  loop Until bosh task state is 'done'
    CloudFoundry->>ODB:last operation
    ODB->>BOSH:get task state
    BOSH->>ODB:queued/processing
    ODB->>CloudFoundry:in progress
  end
  CloudFoundry->>ODB:last operation
  ODB->>BOSH:get task state
  BOSH->>ODB:done
  ODB->>CloudFoundry:completed
