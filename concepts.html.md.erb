---
title: How On-Demand Services Process Commands
owner: London Services Enablement
---

These sequence diagrams in this topic show how an on-demand service sets up and maintains service instances, indicating which tasks are undertaken by the on-demand broker (ODB) and which require interaction with the Service Adapter.

## <a id="catalog"></a>Register Service Broker with Cloud Foundry
<%= partial './mmd/service_catalog_workflow.mmd' %>

## <a id="create-service-instance"></a>Create service instance

Note that there are two ways this can fail: synchronously and asynchronously. When it fails synchronously, the Cloud Controller will subsequently delete the service according to its [orphan mitigation strategy](http://docs.cloudfoundry.org/services/api.html#orphans). In the case when it fails asynchronously (e.g. while BOSH deploys the service instance), the Cloud Controller won't issue a delete request.

<%= partial './mmd/create_service_workflow.mmd' %>

## <a id="delete-service-instance"></a>Delete Service Instance

In the delete service workflow the service adapter is not invoked.

## <a id="post-deploy"></a>Create/Update Service Instance With Post Deploy Errand

ODB will not report success to Cloud Controller until BOSH reports both have completed without error.

<%= partial './mmd/create_post_deploy_workflow.mmd' %>

<%= partial './mmd/delete_service_workflow.mmd' %>

## <a id="update-service-instance"></a>Update Service Instance

When updating a service instance, ODB will make two generate manifest calls to the service adapter. This allows us to check whether the existing service instance is on the latest service offering. Updates can only proceed if the existing service instance is on the latest offering.

<%= partial './mmd/update_service_workflow.mmd' %>

## <a id="upgrade-service-instance"></a>Upgrade Service Instance

In the upgrade service instance workflow the service adapter is invoked once to generate the updated manifest.

<%= partial './mmd/upgrade_service_workflow.mmd' %>

## <a id="bind"></a>Bind
<%= partial './mmd/bind_service_workflow.mmd' %>

## <a id="unbind"></a>Unbind
<%= partial './mmd/unbind_service_workflow.mmd' %>

## <a id="upgrade-all-instances"></a>Upgrade All Service Instances

ODB provides BOSH errand to upgrade all the instances managed by the broker. This can also be used in the scenario when a plan changes; this errand will update all instances that implement the plan with the new plan definition.

<%= partial './mmd/upgrade_all_instances_workflow.mmd' %>

## <a id="delete-all-instances"></a>Delete All Service Instances

ODB provides BOSH errand to delete all the instances managed by the broker.

<%= partial './mmd/delete_all_instances_workflow.mmd' %>
